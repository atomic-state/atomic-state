/**  @license Atomic State
 * Copyright (c) Dany Beltran
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */ (()=>{let{createContext:e,useCallback:t,useContext:n,useEffect:i,useMemo:r,useRef:o,useState:a}=React;class f{constructor(){this.suscribers={}}async addListener(e,t){e in this.suscribers||(this.suscribers[e]={});let n=Object.keys(this.suscribers[e]).length+1;"__proto__"!==e&&"prototype"!==e?this.suscribers[e][n]=t:console.warn('"prototype" and "__proto__" are not valid message names')}async removeListener(e,t){for(let n in this.suscribers[e])this.suscribers[e][n]===t&&delete this.suscribers[e][n]}emit(e,t){for(let n in this.suscribers[e])this.suscribers[e][n](t)}}function s(){let e=new f;return{observer:e,notify:function t(n,i,r){e.emit(n,{storeName:n,hookCall:i,payload:r})}}}let u={},l={},c={},d={},m={},y={},v={},$={},p={},g={},h=e({prefix:"store"});function b({atm:e}){return P(e),null}function L({filt:e}){return T(e),null}let I=({children:e,atoms:t,filters:i,prefix:o="store"})=>{let a=n(h),f=void 0===o?a.prefix:o;if(t)for(let s in t)void 0===d[`${f}-${s}`]&&(d[`${f}-${s}`]=t[s],m[`${f}-${s}`]=!0);if(i)for(let u in i)void 0===$[`${f}-${u}`]&&($[`${f}-${u}`]=i[u],y[`${f}-${u}`]=!0);let v=Object.values(l),p=r(()=>v.map(e=>React.createElement(b,{key:e.name+o,atm:e})),[]),g=Object.values(c),I=r(()=>g.map(e=>React.createElement(L,{key:e?.name+o,filt:e})),[]);return React.createElement(h.Provider,{value:{prefix:f}},p,I,e)},_={},w={};function j(e){let t={};for(let n in d){let[i,r]=n.split("-");void 0===t[i]&&(t[i]={filters:{},atoms:{}}),t[i].atoms[r]=d[n]}for(let o in $){let[a,f]=o.split("-");void 0===t[a]&&(t[a]={filters:{},atoms:{}}),t[a].filters[f]=$[o]}return void 0===e?t:t[e]||{}}function k(e,t="store"){let n=[t,e].join("-");return d[n]}function E(e,t="store"){let n=[t,e].join("-");return $[n]}function N(e){let{effects:f=[],persist:l,localStoragePersistence:c,sync:y=!0,onSync:v=()=>{}}=e,{prefix:b}=n(h),L=b+"-"+e.name,[I,j]=a(!1),k=c||l,E=r(()=>`${Math.random()}`.split(".")[1],[]);L in p||(p[L]=[]);let N=void 0!==e.default,A=function t(){let n=void 0===d[L]&&"function"==typeof e.default,i=n?e.default():e.default instanceof Promise?e.default:void 0,r=i instanceof Promise,o=N&&void 0===d[L]?r?e.default:void 0!==i?i:e.default:d[L];try{return k?"undefined"!=typeof localStorage&&(void 0===d[L]||m[L])&&(m[L]=!1,d[L]=r?void 0:o):void 0===d[L]&&(d[L]=o),o}catch(a){return o}}(),[S,x]=a(()=>{try{return(async()=>{let t="undefined"==typeof localStorage?e.default:await localStorage.getItem(L);return"undefined"==typeof localStorage?e.default:JSON.parse(t)||e.default})()}catch(t){return A}}),[V,C]=a((A instanceof Promise||"function"==typeof A)&&void 0===d[L]?void 0:(d[L]=A,A));g[L]||(g[L]=0),u[L]||(u[L]=s());let{observer:D,notify:F}=u[L],[K,T]=a(!1),W=o(!1),P=t(t=>{let n=!1,i,r;function o(){n=!0}i="function"==typeof t?t(d[L]):t,r=(()=>{try{return JSON.stringify(i)!==JSON.stringify(d[L])}catch(e){return!1}})();let a=(()=>{try{if("function"==typeof d[L])return!0;if(JSON.stringify(i)===JSON.stringify(e.default)&&!_[L])return _[L]=!0,!0}catch(t){return!0}})(),s="function"==typeof d[L]||r||a;try{for(let u of p[L])u()}catch(l){}finally{p[L]=[];try{for(let c of f){let m=c({previous:V,state:i,dispatch:P,cancel:o});m instanceof Promise?m.then(e=>{void 0===e||e?"function"==typeof e&&p[L].push(e):n=!0}):void 0===m||m?"function"==typeof m&&p[L].push(m):n=!0}}catch(y){T(!0)}finally{if(!n){d[L]=i,k&&localStorage.setItem(L,JSON.stringify(i));try{s&&F(L,E,i)}finally{C(i)}}}}},[E,F,K,L,k,W,V,e.name,]);i(()=>{async function e(){if("undefined"!=typeof localStorage&&void 0!==localStorage[L])try{if(localStorage[L]!==JSON.stringify(d[L])){let e=JSON.parse(localStorage[L]);P(e),await v(e)}}catch(t){}}if(k&&"undefined"!=typeof window){let t=void 0!==window.addEventListener;if(t&&y)return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}return()=>{}},[e.name]),i(()=>{async function e(){if(w[L]=!0,void 0!==S&&!W.current){let e=setTimeout(async()=>{if(k){let e=await S;JSON.stringify(e)===JSON.stringify(d[L])||_[L]||P(e),j(!0)}},0),t=setTimeout(()=>{x(void 0),W.current=!0},0);return()=>{clearTimeout(e),clearTimeout(t)}}}w[L]||e()},[S,P,W]),i(()=>{async function t(){var t;if(void 0===d[L]&&"function"==typeof e.default){if(0===g[L]){g[L]+=1;let n=void 0!==e.default?(async()=>"function"==typeof e.default?e.default():e.default)():void 0;void 0!==n&&n.then(e=>{d[L]=e,F(L,E,d[L]),P(e)})}else g[L]+=1,(V||d[L])&&(null===(t=u[L])||void 0===t||t.notify(L,E,void 0!==V?V:d[L]))}}t()},[V,e.default,P,e.name,E]),i(()=>()=>{g[L]=0},[e.name]),i(()=>{let e=async e=>{e.hookCall!==E&&C(e.payload)};return D.addListener(L,e),()=>{D.removeListener(L,e)}},[K]),i(()=>{async function e(){if("undefined"!=typeof localStorage){let e=await localStorage.getItem(L);(void 0!==e||null===e)&&(k?localStorage.setItem(L,JSON.stringify(V)):localStorage.removeItem(L))}}e()},[e.name,k,V]);let q=t(function(e){let t=[b,e["atom-name"]].join("-"),n=d[t];return n},[b]),z=t(function(e){let t=[b,e["filter-name"]].join("-"),n=$[t];return n},[b]),B=r(()=>e.actions||{},[e.actions]),G=r(()=>Object.fromEntries(Object.keys(B).map(e=>[e,t=>B[e]({args:t,state:V,dispatch:P,get:q,read:z}),])),[V]);return[V,P,G]}let A={};function S(e){e.ignoreKeyWarning&&(A[e.name]=!0),v[e.name]=!0;let t=()=>N(e);return t["atom-name"]=e.name,t["init-object"]=e,t}let x=S,V={},C={},D={},F={};function K(e){let{name:o="",get:f}=e;c[e?.name]||(c[e?.name]=e);let l={},m={},v=()=>{let c={},p={};v.deps={};let{prefix:g}=n(h);l[`${g}-`]||(l[`${g}-`]={});let b=g+"-"+o;D[b]||(D[b]=s());let L=D[b],I=t(function e(t,n){L.notify(b,t,n)},[g,b]),_=r(()=>({get:e=>("function"!=typeof e?(l[`${g}-`][`${g}-${e.name}`]=!0,c[`${g}-${e.name}`]=d[`${g}-${e.name}`],v.deps=Object.assign(Object.assign({},v.deps),{[`${g}-${e.name}`]:!0})):(l[`${g}-`][`${g}-${e["atom-name"]}`]=!0,c[`${g}-${e["atom-name"]}`]=d[`${g}-${e["atom-name"]}`],v.deps=Object.assign(Object.assign({},v.deps),{[`${g}-${e["atom-name"]}`]:!0})),"function"!=typeof e?void 0===d[`${g}-${e.name}`]?e.default:d[`${g}-${e.name}`]:void 0===d[`${g}-${e["atom-name"]}`]?e["init-object"].default:d[`${g}-${e["atom-name"]}`]),read(e){var t;return"function"!=typeof e?p[`${g}-${e.name}`]=!0:p[`${g}-${e["filter-name"]}`]=!0,"function"!=typeof e?void 0===$[`${g}-${e.name}`]?e.default:$[`${g}-${e.name}`]:void 0===$[`${g}-${e["filter-name"]}`]?null===(t=e["init-object"])||void 0===t?void 0:t.default:$[`${g}-${e["filter-name"]}`]}}),[g]),w=r(()=>Math.random(),[]),j=function t(){try{return C[b]?$[b]:(()=>{C[b]=!0,$[b]=e.default;let t;try{if(t=f(_),void 0===t)return e.default;(async()=>{$[b]=await t})()}catch(n){}finally{return t}})()}catch(n){return e.default}}(),[k,E]=a(()=>j instanceof Promise||void 0===j?e.default:($[b]=j,j));async function N(e){if("function"==typeof e.payload||JSON.stringify(e.payload)!==JSON.stringify(c[e.storeName])){e.storeName in l[`${g}-`]&&(c[e.storeName]=e.payload);try{if(!m[b]){m[b]=!0;let t=setTimeout(async()=>{let n=e.storeName in l[`${g}-`]||e.storeName in p?await f(_):$[b];$[b]=n,I(w,n),"function"==typeof n?E(()=>n):E(n),m[b]=!1,clearTimeout(t)},0)}}catch(n){}}}async function A(e){let{storeName:t,payload:n}=e;w!==e.hookCall&&("function"==typeof n?E(()=>n):E(n))}return i(()=>{C[b]||I(w,k)},[k,b]),i(()=>{j instanceof Promise&&j.then(e=>{$[b]=e,E(e)})},[j]),i(()=>()=>{C[b]=!1},[]),i(()=>{var e,t;if(!F[b]){for(let n in F[b]=!0,C[b]||f(_),l[`${g}-`])null===(e=u[n])||void 0===e||e.observer.addListener(n,N);for(let i in p)null===(t=D[i])||void 0===t||t.observer.addListener(i,N);return()=>{var e,t;for(let n in y[b]=!0,l[`${g}-`])null===(e=u[n])||void 0===e||e.observer.removeListener(n,N);for(let i in p)null===(t=D[i])||void 0===t||t.observer.removeListener(i,N)}}},[e,g]),i(()=>{var e;return null===(e=L.observer)||void 0===e||e.addListener(b,A),()=>{var e;F[b]=!1,null===(e=null==L?void 0:L.observer)||void 0===e||e.removeListener(b,A)}},[e,g,k]),k};return v["filter-name"]=o,v["init-object"]=e,v}function T(e){let{prefix:t}=n(h);return"function"!=typeof e?(void 0===V[`${t}-${e.name}`]?V[`${t}-${e.name}`]=K(e):V[`${t}-${e.name}`]["init-object"]!==e&&(V[`${t}-${e.name}`]=K(e)),V[`${t}-${e.name}`]()):e()}let W={};function P(e){return"function"!=typeof e&&(void 0===W[e.name]?W[e.name]=x(e):W[e.name]["init-object"]!==e&&(W[e.name]=x(e))),"function"!=typeof e?W[e.name]():e()}function q(e){return P(e)[0]}function z(e){return P(e)[1]}function B(e){return P(e)[2]}let G=(()=>{let e=new f;return e})();function H(e){let[t,n]=a(e||{});async function r(){let e={};if("undefined"!=typeof localStorage){for(let t in localStorage)if(!t.match(/clear|getItem|key|length|removeItem|setItem/))try{void 0!==localStorage[t]&&(e[t]=JSON.parse(localStorage[t]))}catch(i){e[t]=localStorage[t]}}n(e)}return i(()=>{r()},[]),i(()=>(G.addListener("store-changed",r),()=>{G.removeListener("store-changed",r)}),[]),t}let J={set(e,t){"undefined"!=typeof localStorage&&"function"==typeof localStorage.setItem&&(localStorage.setItem(e,JSON.stringify(t)),G.emit("store-changed",t))},async remove(e){"undefined"!=typeof localStorage&&"function"==typeof localStorage.removeItem&&(localStorage.removeItem(e),G.emit("store-changed",{}))},get(e,t=null){if("undefined"==typeof localStorage)return t;if("function"==typeof localStorage.getItem)try{return JSON.parse(localStorage.getItem(e))}catch(n){return t}else try{return JSON.parse(localStorage[e])}catch(i){return t}}};function M(e,t=null){let[n,r]=a(t),o=()=>{if("undefined"!=typeof localStorage&&JSON.stringify(localStorage[e])!==JSON.stringify(t))try{r(JSON.parse(localStorage[e]))}catch(n){r(t)}};return i(()=>(o(),G.addListener("store-changed",o),()=>{G.removeListener("store-changed",o)}),[]),n}window.atom=S,window.useAtom=P,window.useValue=q,window.useDispatch=z,window.useActions=B,window.AtomicState=I,window.takeSnapshot=j,window.getAtomValue=k,window.getFilterValue=E,window.filter=K,window.useFilter=T,window.storage=J,window.useStorage=H,window.useStorageItem=M})();