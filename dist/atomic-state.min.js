/**  @license Atomic State
 * Copyright (c) Dany Beltran
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
*/ (()=>{let{createContext:e,useCallback:t,useContext:n,useEffect:r,useMemo:i,useRef:a,useState:l}=React;class o{constructor(){this.suscribers={}}async addListener(e,t){e in this.suscribers||(this.suscribers[e]={});let n=Object.keys(this.suscribers[e]).length+1;"__proto__"!==e&&"prototype"!==e?this.suscribers[e][n]=t:console.warn('"prototype" and "__proto__" are not valid message names')}async removeListener(e,t){for(let n in this.suscribers[e])this.suscribers[e][n]===t&&delete this.suscribers[e][n]}emit(e,t){for(let n in this.suscribers[e])this.suscribers[e][n](t)}}function u(){let e=new o;return{observer:e,notify:function t(n,r,i){e.emit(n,{storeName:n,hookCall:r,payload:i})}}}let s={},f={},c={},d={},m={},y={},v={},$={},p={},h={},g=e({prefix:"store"});function b({atm:e}){return G(e),null}function _({filt:e}){return z(e),null}function j(e){return void 0!==e}function L(e){return"function"==typeof e}function I(e){return e instanceof Promise}function w(e,t){return JSON.stringify(e)===JSON.stringify(t)}let E=({children:e,atoms:t,filters:r,prefix:a="store"})=>{let l=n(g),o=j(a)?a:l.prefix;if(t)for(let u in t){let s=`${o}-${u}`;j(f[s])||(f[s]=t[u],m[s]=!0)}if(r)for(let v in r){let p=`${o}-${v}`;j($[p])||($[p]=r[v],y[p]=!0)}let h=Object.values(c),L=i(()=>h.map(e=>React.createElement(React.StrictMode,{key:(null==e?void 0:e.name)+a},React.createElement(b,{atm:e}))),[]),I=Object.values(d),w=i(()=>I.map(e=>React.createElement(React.StrictMode,{key:(null==e?void 0:e.name)+a},React.createElement(_,{filt:e}))),[]);return React.createElement(g.Provider,{value:{prefix:o}},React.createElement(React.Fragment,null,L,w),e)},N={},k={};function S(e){let t={};for(let n in f){let[r,i]=n.split("-");j(t[r])||(t[r]={filters:{},atoms:{}}),t[r].atoms[i]=f[n]}for(let a in $){let[l,o]=a.split("-");j(t[l])||(t[l]={filters:{},atoms:{}}),t[l].filters[o]=$[a]}return j(e)?t[e]||{}:t}function A(e,t="store"){let n=[t,e].join("-");return f[n]}function x(e,t="store"){let n=[t,e].join("-");return $[n]}function F(e){let{effects:o=[],persist:c,localStoragePersistence:d,sync:y=!0,onSync:v=()=>{}}=e,{prefix:b}=n(g),_=b+"-"+e.name,[E,S]=l(!1),A=d||c,x=i(()=>`${Math.random()}`.split(".")[1],[]);_ in p||(p[_]=[]);let F=j(e.default),V=function t(){let n=!j(f[_])&&L(e.default),r=n?e.default():I(e.default)?e.default:void 0,i=I(r),a=F?j(f[_])?f[_]:i?e.default:j(r)?r:e.default:f[_];try{return A?"undefined"!=typeof localStorage&&(!j(f[_])||m[_])&&(m[_]=!1,f[_]=i?void 0:a):j(f[_])||(f[_]=a),a}catch(l){return a}}(),[C,M]=l(()=>{if(c)try{return(async()=>{let t="undefined"==typeof localStorage?e.default:await localStorage.getItem(_);return"undefined"==typeof localStorage?e.default:JSON.parse(t)||e.default})()}catch(t){return V}}),[D,K]=l((I(V)||L(V))&&!j(f[_])?void 0:(f[_]=V,V));h[_]||(h[_]=0),s[_]||(s[_]=u());let{observer:P,notify:W}=s[_],[q,z]=l(!1),B=a(!1),G=t(t=>{let n=!1,r,i;function a(){n=!0}r=L(t)?t(f[_]):t,i=(()=>{try{return!w(r,f[_])}catch(e){return!1}})();let l=(()=>{try{if(L(f[_]))return!0;if(w(r,e.default)&&!N[_])return N[_]=!0,!0;return!1}catch(t){return!0}})(),u=L(f[_])||i||l;try{for(let s of p[_])s()}catch(c){}finally{p[_]=[];try{for(let d of o){let m=d({previous:D,state:r,dispatch:G,cancel:a});I(m)?m.then(e=>{j(e)&&!e?n=!0:L(e)&&p[_].push(e)}):j(m)&&!m?n=!0:L(m)&&p[_].push(m)}}catch(y){z(!0)}finally{if(!n){f[_]=r,A&&localStorage.setItem(_,JSON.stringify(r));try{u&&W(_,x,r)}finally{K(r)}}}}},[x,W,q,_,A,B,D,e.name,]);r(()=>{async function e(){if("undefined"!=typeof localStorage&&j(localStorage[_]))try{if(!w(localStorage[_],f[_])){let e=JSON.parse(localStorage[_]);G(e),await v(e)}}catch(t){}}if(A&&"undefined"!=typeof window){let t=j(window.addEventListener);if(t&&y)return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}return()=>{}},[e.name]),r(()=>{async function e(){if(k[_]=!0,j(C)&&!B.current){let e=setTimeout(async()=>{if(A){let e=await C;w(e,f[_])||j(N[_])||G(e),S(!0)}},0),t=setTimeout(()=>{M(void 0),B.current=!0},0);return()=>{clearTimeout(e),clearTimeout(t)}}return()=>{}}k[_]||e()},[C,G,B,_]),r(()=>{async function t(){var t;if(!j(f[_])&&L(e.default)){if(0===h[_]){h[_]+=1;let n=j(e.default)?(async()=>L(e.default)?e.default():e.default)():void 0;j(n)&&n.then(e=>{f[_]=e,W(_,x,f[_]),G(e)})}else h[_]+=1,(D||f[_])&&(null===(t=s[_])||void 0===t||t.notify(_,x,j(D)?D:f[_]))}}t()},[D,e.default,G,e.name,x]),r(()=>()=>{h[_]=0},[e.name]),r(()=>{let e=async e=>{e.hookCall!==x&&K(e.payload)};return P.addListener(_,e),()=>{P.removeListener(_,e)}},[q]),r(()=>{async function e(){if("undefined"!=typeof localStorage){let e=await localStorage.getItem(_);(j(e)||null===e)&&(A?localStorage.setItem(_,JSON.stringify(D)):localStorage.removeItem(_))}}e()},[e.name,A,D]);let H=t(function(e){let t=[b,e["atom-name"]].join("-"),n=f[t];return n},[b]),J=t(function(e){let t=[b,e["filter-name"]].join("-"),n=$[t];return n},[b]),O=i(()=>e.actions||{},[e.actions]),Q=i(()=>Object.fromEntries(Object.keys(O).map(e=>[e,t=>O[e]({args:t,state:D,dispatch:G,get:H,read:J}),])),[D]);return[D,G,Q]}let V={};function C(e){e.ignoreKeyWarning&&(V[e.name]=!0),v[e.name]=!0,c[null==e?void 0:e.name]||(c[null==e?void 0:e.name]=e);let t=()=>F(e);return t["atom-name"]=e.name,t["init-object"]=e,t}let M=C,D={},K={},P={},W={};function q(e){let{name:a="",get:o}=e;j(d[null==e?void 0:e.name])||(d[null==e?void 0:e.name]=e);let c={},m={},y={},v={},p={},h=()=>{let b=i(()=>Math.random(),[]);h.deps={};let{prefix:_}=n(g);c[`${_}-`]||(c[`${_}-`]={});let E=_+"-"+a;P[E]||(P[E]=u());let N=P[E],k=t(function e(t,n){N.notify(E,t,n)},[_,b,E]);for(let S in c[`${_}-`])p[S]!==f[S]&&(K[E]=!1,m[E]=!1);for(let A in y)v[A]!==$[A]&&(K[E]=!1,m[E]=!1);let x=i(()=>({get(e){var t;if(W[E]=!0,L(e)){let n=[_,null===(t=null==e?void 0:e["init-object"])||void 0===t?void 0:t.name,].join("-");c[`${_}-`][n]=!0,p[n]=f[n],h.deps=Object.assign(Object.assign({},h.deps),{[n]:!0})}else{let r=[_,e.name].join("-");c[`${_}-`][r]=!0,p[r]=f[r],h.deps=Object.assign(Object.assign({},h.deps),{[r]:!0})}let i=[_,C.name].join("-"),a=[_,e["atom-name"]].join("-");return L(e)?j(f[a])?f[a]:e["init-object"].default:j(f[i])?f[i]:e.default},read(e){var t;W[E]=!0;let n=L(e)?[_,e["filter-name"]].join("-"):[_,e.name].join("-");return L(e),y[n]=!0,v[n]=$[n],L(e)?j($[n])?$[n]:null===(t=e["init-object"])||void 0===t?void 0:t.default:j($[n])?$[n]:e.default}}),[_]),F=$[E],V=function t(){try{let n;return K[E]?$[E]:(()=>{K[E]=!0,$[E]=e.default;try{if(n=o(x),!j(n))return e.default;return(async()=>{n=await n,$[E]=n,j(n)&&k("",n)})(),n}catch(t){}finally{return j(n)&&k("",n),n}})()}catch(r){return e.default}}();I(V)&&($[E]=V,setTimeout(async()=>{$[E]=await V,k(b,await $[E])},0)),j(V)?I(V)?V.then(e=>{F=e,$[E]=e,N.notify(E,"",e)}):(F=V,$[E]=V):j(F)||(F=e.default);let[M,D]=l(()=>j(F)&&I(F)?I(V)?e.default:V:F);async function q(e){let t=e.storeName in y;if(L(e.payload)||(t?!w($[e.storeName],v[e.storeName]):!w(e.payload,p[e.storeName]))){e.storeName in(t?y:c[`${_}-`])&&j(e.payload)&&(t?v[e.storeName]=e.payload:p[e.storeName]=e.payload);try{if(!m[E]){m[E]=!0;let n=e.storeName in c[`${_}-`]||e.storeName in y?o(x):$[E];$[E]=n,(async()=>{if(L(n))k(b,n),D(()=>n);else if(j(n)){if(I(n)){let e=await n;D(e),k(b,e)}else D(n),k(b,n)}m[E]=!1})()}}catch(r){}}}async function z(e){let{payload:t}=e;if(b!==e.hookCall){let n=await t;L(n)?D(()=>n):j(n)&&D(n)}}return r(()=>{var e;null===(e=s[E])||void 0===e||e.notify(E,"",M)},[M]),r(()=>{!K[E]&&j(M)&&k(b,M)},[M,b,E,K[E]]),r(()=>{I(V)&&V.then(e=>{j(e)&&($[E]=e,D(e))})},[V]),r(()=>{var e,t;for(let n in c[`${_}-`])null===(e=s[n])||void 0===e||e.observer.addListener(n,q);for(let r in y)null===(t=P[r])||void 0===t||t.observer.addListener(r,q);return()=>{var e,t;for(let n in c[`${_}-`])null===(e=s[n])||void 0===e||e.observer.removeListener(n,q);for(let r in y)null===(t=P[r])||void 0===t||t.observer.removeListener(r,q)}},[e,b,d[E],_]),r(()=>{var e;return null===(e=N.observer)||void 0===e||e.addListener(E,z),()=>{var e;null===(e=null==N?void 0:N.observer)||void 0===e||e.removeListener(E,z)}},[E]),M};return h["filter-name"]=a,h["init-object"]=e,h}function z(e){let{prefix:t}=n(g);if(L(e)){let r=e["init-object"];r!==d[null==r?void 0:r.name]&&j(r)&&(d[null==r?void 0:r.name]=r,K[t+"-"+(null==r?void 0:r.name)]=!1,W[t+"-"+(null==r?void 0:r.name)]=!1)}else d[e.name]!==e&&(d[e.name]=e,K[t+"-"+e.name]=!1,W[t+"-"+e.name]=!1);return L(e)?e():(()=>{let n=[t,e.name].join("-");return j(D[n])?D[n]["init-object"]!==e&&(D[n]=q(e)):D[n]=q(d[e.name]),D[n]()})()}let B={};function G(e){return L(e)||(j(B[e.name])?B[e.name]["init-object"]!==e&&(B[e.name]=M(e)):B[e.name]=M(e)),L(e)?e():B[e.name]()}function H(e){return G(e)[0]}function J(e){return G(e)[1]}function O(e){return G(e)[2]}let Q=(()=>{let e=new o;return e})();function R(e){let[t,n]=l(e||{});async function i(){let e={};if("undefined"!=typeof localStorage){for(let t in localStorage)if(!t.match(/clear|getItem|key|length|removeItem|setItem/))try{j(localStorage[t])&&(e[t]=JSON.parse(localStorage[t]))}catch(r){e[t]=localStorage[t]}}n(e)}return r(()=>{i()},[]),r(()=>(Q.addListener("store-changed",i),()=>{Q.removeListener("store-changed",i)}),[]),t}let T={set(e,t){"undefined"!=typeof localStorage&&L(localStorage.setItem)&&(localStorage.setItem(e,JSON.stringify(t)),Q.emit("store-changed",t))},async remove(e){"undefined"!=typeof localStorage&&L(localStorage.removeItem)&&(localStorage.removeItem(e),Q.emit("store-changed",{}))},get(e,t=null){if("undefined"==typeof localStorage)return t;if(L(localStorage.getItem))try{return JSON.parse(localStorage.getItem(e))}catch(n){return t}else try{return JSON.parse(localStorage[e])}catch(r){return t}}};function U(e,t=null){let[n,i]=l(t),a=()=>{if("undefined"!=typeof localStorage&&!w(localStorage[e],t))try{i(JSON.parse(localStorage[e]))}catch(n){i(t)}};return r(()=>(a(),Q.addListener("store-changed",a),()=>{Q.removeListener("store-changed",a)}),[]),n}window.atom=C,window.useAtom=G,window.useValue=H,window.useDispatch=J,window.useActions=O,window.AtomicState=E,window.takeSnapshot=S,window.getAtomValue=A,window.getFilterValue=x,window.filter=q,window.useFilter=z,window.storage=T,window.useStorage=R,window.useStorageItem=U})();