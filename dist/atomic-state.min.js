/**  @license Atomic State
 * Copyright (c) Dany Beltran
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
*/ (()=>{let{createContext:e,useCallback:t,useContext:n,useEffect:r,useMemo:i,useRef:a,useState:l}=React;class o{constructor(){this.suscribers={}}async addListener(e,t){e in this.suscribers||(this.suscribers[e]={});let n=Object.keys(this.suscribers[e]).length+1;"__proto__"!==e&&"prototype"!==e?this.suscribers[e][n]=t:console.warn('"prototype" and "__proto__" are not valid message names')}async removeListener(e,t){for(let n in this.suscribers[e])this.suscribers[e][n]===t&&delete this.suscribers[e][n]}emit(e,t){for(let n in this.suscribers[e])this.suscribers[e][n](t)}}function u(){let e=new o;return{observer:e,notify:function t(n,r,i){e.emit(n,{storeName:n,hookCall:r,payload:i})}}}let s={},f={},c={},d={},m={},v={},y={},$={},p={},h={},g=e({prefix:"store"});function b({atm:e}){return G(e),null}function j({filt:e}){return z(e),null}function L(e){return void 0!==e}function I(e){return"function"==typeof e}function _(e){return e instanceof Promise}function w(e,t){return JSON.stringify(e)===JSON.stringify(t)}let E=({children:e,atoms:t,filters:r,prefix:a="store"})=>{let l=n(g),o=L(a)?a:l.prefix;if(t)for(let u in t){let s=`${o}-${u}`;L(f[s])||(f[s]=t[u],m[s]=!0)}if(r)for(let y in r){let p=`${o}-${y}`;L($[p])||($[p]=r[y],v[p]=!0)}let h=Object.values(c),I=i(()=>Math.random(),[]).toString(),_=i(()=>h.map(e=>React.createElement(React.StrictMode,{key:(null==e?void 0:e.name)+a+I},React.createElement(b,{atm:e}))),[h]),w=Object.values(d),E=i(()=>w.map(e=>React.createElement(React.StrictMode,{key:(null==e?void 0:e.name)+a+I},React.createElement(j,{filt:e}))),[w]);return React.createElement(g.Provider,{value:{prefix:o}},React.createElement(React.Fragment,null,_,E),e)},N={},k={};function S(e){let t={};for(let n in f){let[r,i]=n.split("-");L(t[r])||(t[r]={filters:{},atoms:{}}),t[r].atoms[i]=f[n]}for(let a in $){let[l,o]=a.split("-");L(t[l])||(t[l]={filters:{},atoms:{}}),t[l].filters[o]=$[a]}return L(e)?t[e]||{}:t}function A(e,t="store"){let n=[t,e].join("-");return f[n]}function x(e,t="store"){let n=[t,e].join("-");return $[n]}function F(e){let{effects:o=[],persist:c,localStoragePersistence:d,sync:v=!0,onSync:y=()=>{}}=e,{prefix:b}=n(g),j=b+"-"+e.name,[E,S]=l(!1),A=d||c,x=i(()=>`${Math.random()}`.split(".")[1],[]);j in p||(p[j]=[]);let F=L(e.default),V=L(f[j])?f[j]:e.default,C=function t(){let n=!L(f[j])&&I(e.default),r=n?e.default():_(e.default)?e.default:void 0,i=_(r),a=F?L(f[j])?V:i?e.default:L(r)?r:V:V;try{return A?"undefined"!=typeof localStorage&&(!L(f[j])||m[j])&&(m[j]=!1,f[j]=i?void 0:a):L(f[j])||(f[j]=a),a}catch(l){return a}}(),[M,D]=l(()=>{if(c)try{return(async()=>{let t="undefined"==typeof localStorage?e.default:await localStorage.getItem(j);return"undefined"==typeof localStorage?e.default:JSON.parse(t)||V})()}catch(t){return C}}),[K,P]=l((_(C)||I(C))&&!L(f[j])?void 0:(f[j]=C,C));h[j]||(h[j]=0),s[j]||(s[j]=u());let{observer:W,notify:q}=s[j],[z,B]=l(!1),G=a(!1),H=t(e=>{let t=!1,n,r;function i(){t=!0}n=I(e)?e(f[j]):e,r=(()=>{try{return!w(n,f[j])}catch(e){return!1}})();let a=(()=>{try{if(I(f[j]))return!0;if(w(n,V)&&!N[j])return N[j]=!0,!0;return!1}catch(e){return!0}})(),l=I(f[j])||r||a;try{for(let u of p[j])u()}catch(s){}finally{p[j]=[];try{for(let c of o){let d=c({previous:K,state:n,dispatch:H,cancel:i});_(d)?d.then(e=>{L(e)&&!e?t=!0:I(e)&&p[j].push(e)}):L(d)&&!d?t=!0:I(d)&&p[j].push(d)}}catch(m){B(!0)}finally{if(!t){L(n)&&(f[j]=n,A&&localStorage.setItem(j,JSON.stringify(n)));try{l&&L(n)&&q(j,x,n)}finally{L(n)&&P(n)}}}}},[x,q,z,j,A,G,K,e.name,]);r(()=>{async function e(){if("undefined"!=typeof localStorage&&L(localStorage[j]))try{if(!w(localStorage[j],f[j])){let e=JSON.parse(localStorage[j]);H(e),await y(e)}}catch(t){}}if(A&&"undefined"!=typeof window){let t=L(window.addEventListener);if(t&&v)return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}return()=>{}},[e.name]),r(()=>{async function e(){if(k[j]=!0,L(M)&&!G.current){let e=setTimeout(async()=>{if(A){let e=await M;w(e,f[j])||L(N[j])||H(e),S(!0)}},0),t=setTimeout(()=>{D(void 0),G.current=!0},0);return()=>{clearTimeout(e),clearTimeout(t)}}return()=>{}}k[j]||e()},[M,H,G,j]),r(()=>{async function t(){var t;if(!L(f[j])&&I(e.default)){if(0===h[j]){h[j]+=1;let n=L(e.default)?(async()=>I(e.default)?e.default():e.default)():void 0;L(n)&&n.then(e=>{f[j]=e,q(j,x,f[j]),H(e)})}else h[j]+=1,(K||f[j])&&(null===(t=s[j])||void 0===t||t.notify(j,x,L(K)?K:f[j]))}}t()},[K,V,H,e.name,x]),r(()=>()=>{h[j]=0},[e.name]),r(()=>{let e=async e=>{e.hookCall!==x&&L(e.payload)&&P(e.payload)};return W.addListener(j,e),()=>{W.removeListener(j,e)}},[z]),r(()=>{async function e(){if("undefined"!=typeof localStorage){let e=await localStorage.getItem(j);(L(e)||null===e)&&(A?L(K)&&localStorage.setItem(j,JSON.stringify(K)):localStorage.removeItem(j))}}e()},[e.name,A,K]);let J=t(function(e){let t=[b,e["atom-name"]].join("-"),n=f[t];return n},[b]),O=t(function(e){let t=[b,e["filter-name"]].join("-"),n=$[t];return n},[b]),Q=i(()=>e.actions||{},[e.actions]),R=i(()=>Object.fromEntries(Object.keys(Q).map(e=>[e,t=>Q[e]({args:t,state:K,dispatch:H,get:J,read:O}),])),[K]);return[K,H,R]}let V={};function C(e){e.ignoreKeyWarning&&(V[e.name]=!0),y[e.name]=!0,c[null==e?void 0:e.name]||(c[null==e?void 0:e.name]=e);let t=()=>F(e);return t["atom-name"]=e.name,t["init-object"]=e,t}let M=C,D={},K={},P={},W={};function q(e){L(d[null==e?void 0:e.name])||(d[null==e?void 0:e.name]=e);let{name:a=""}=d[null==e?void 0:e.name],o={},c={},m={},v={},y={},p=()=>{let p=i(()=>Math.random(),[]),{prefix:h}=n(g);o[`${h}-`]||(o[`${h}-`]={});let b=h+"-"+a;P[b]||(P[b]=u());let j=P[b],E=t(function e(t,n){j.notify(b,t,n)},[h,p,b]);for(let N in o[`${h}-`])y[N]!==f[N]&&(K[b]=!1);for(let k in m)v[k]!==$[k]&&(K[b]=!1);let S=i(()=>({get(e){var t;if(W[b]=!0,I(e)){let n=[h,null===(t=null==e?void 0:e["init-object"])||void 0===t?void 0:t.name,].join("-");o[`${h}-`][n]=!0,y[n]=f[n]}else{let r=[h,e.name].join("-");o[`${h}-`][r]=!0,y[r]=f[r]}let i=[h,C.name].join("-"),a=[h,e["atom-name"]].join("-");return I(e)?L(f[a])?f[a]:e["init-object"].default:L(f[i])?f[i]:e.default},read(e){var t;W[b]=!0;let n=I(e)?[h,e["filter-name"]].join("-"):[h,e.name].join("-");return I(e),m[n]=!0,v[n]=$[n],I(e)?L($[n])?$[n]:null===(t=e["init-object"])||void 0===t?void 0:t.default:L($[n])?$[n]:e.default}}),[h]),A=$[b],x=function t(){try{let n;return K[b]?$[b]:(()=>{var t;K[b]=!0,$[b]=e.default;try{if(n=null===(t=d[a])||void 0===t?void 0:t.get(S),!L(n))return e.default;return(async()=>{n=await n,$[b]=n,L(n)&&E("",n)})(),n}catch(r){}finally{return L(n)&&E("",n),n}})()}catch(r){return e.default}}();K[b]=!0,_(x)&&($[b]=x,setTimeout(async()=>{$[b]=await x,E(p,await $[b])},0)),L(x)?_(x)?x.then(e=>{A=e,$[b]=e,j.notify(b,"",e)}):(A=x,$[b]=x):L(A)||(A=e.default);let[F,V]=l(()=>L(A)&&_(A)?_(x)?e.default:x:A);async function M(e){var t;let n=e.storeName in m;if(I(e.payload)||(n?!w($[e.storeName],v[e.storeName]):!w(e.payload,y[e.storeName]))){e.storeName in(n?m:o[`${h}-`])&&L(e.payload)&&(n?v[e.storeName]=e.payload:y[e.storeName]=e.payload);try{if(!c[b]){c[b]=!0;let r=e.storeName in o[`${h}-`]||e.storeName in m?null===(t=d[a])||void 0===t?void 0:t.get(S):$[b];$[b]=r,(async()=>{if(I(r))E(p,r),V(()=>r);else if(L(r)){if(_(r)){let e=await r;V(e),E(p,e)}else V(r),E(p,r)}c[b]=!1})()}}catch(i){}}}async function D(e){let{payload:t}=e;if(p!==e.hookCall){let n=await t;I(n)?V(()=>n):L(n)&&V(n)}}return r(()=>{var e;null===(e=s[b])||void 0===e||e.notify(b,"",F)},[F]),r(()=>{!K[b]&&L(F)&&E(p,F)},[F,p,b,K[b]]),r(()=>{_(x)&&x.then(e=>{L(e)&&($[b]=e,V(e))})},[x]),r(()=>{var e,t;for(let n in o[`${h}-`])null===(e=s[n])||void 0===e||e.observer.addListener(n,M);for(let r in m)null===(t=P[r])||void 0===t||t.observer.addListener(r,M);return()=>{var e,t;for(let n in o[`${h}-`])null===(e=s[n])||void 0===e||e.observer.removeListener(n,M);for(let r in m)null===(t=P[r])||void 0===t||t.observer.removeListener(r,M)}},[]),r(()=>{var e;return null===(e=j.observer)||void 0===e||e.addListener(b,D),()=>{var e;null===(e=null==j?void 0:j.observer)||void 0===e||e.removeListener(b,D)}},[b]),F};return p["filter-name"]=a,p["init-object"]=e,p}function z(e){let{prefix:t}=n(g);if(I(e)){let r=e["init-object"];r!==d[null==r?void 0:r.name]&&L(r)&&((d[null==r?void 0:r.name]||{}).get=null==r?void 0:r.get)}else d[e.name]!==e&&((d[null==e?void 0:e.name]||{}).get=null==e?void 0:e.get);return I(e)?e():(()=>{let n=[t,e.name].join("-");return L(D[n])?D[n]["init-object"]!==e&&(D[n]=q(e)):D[n]=q(d[e.name]),D[n]()})()}let B={};function G(e){return I(e)||(L(B[e.name])?B[e.name]["init-object"]!==e&&(B[e.name]=M(e)):B[e.name]=M(e)),I(e)?e():B[e.name]()}function H(e){return G(e)[0]}function J(e){return G(e)[1]}function O(e){return G(e)[2]}let Q=(()=>{let e=new o;return e})();function R(e){let[t,n]=l(e||{});async function i(){let e={};if("undefined"!=typeof localStorage){for(let t in localStorage)if(!t.match(/clear|getItem|key|length|removeItem|setItem/))try{L(localStorage[t])&&(e[t]=JSON.parse(localStorage[t]))}catch(r){e[t]=localStorage[t]}}n(e)}return r(()=>{i()},[]),r(()=>(Q.addListener("store-changed",i),()=>{Q.removeListener("store-changed",i)}),[]),t}let T={set(e,t){"undefined"!=typeof localStorage&&I(localStorage.setItem)&&(localStorage.setItem(e,JSON.stringify(t)),Q.emit("store-changed",t))},async remove(e){"undefined"!=typeof localStorage&&I(localStorage.removeItem)&&(localStorage.removeItem(e),Q.emit("store-changed",{}))},get(e,t=null){if("undefined"==typeof localStorage)return t;if(I(localStorage.getItem))try{return JSON.parse(localStorage.getItem(e))}catch(n){return t}else try{return JSON.parse(localStorage[e])}catch(r){return t}}};function U(e,t=null){let[n,i]=l(t),a=()=>{if("undefined"!=typeof localStorage&&!w(localStorage[e],t))try{i(JSON.parse(localStorage[e]))}catch(n){i(t)}};return r(()=>(a(),Q.addListener("store-changed",a),()=>{Q.removeListener("store-changed",a)}),[]),n}window.atom=C,window.useAtom=G,window.useValue=H,window.useDispatch=J,window.useActions=O,window.AtomicState=E,window.takeSnapshot=S,window.getAtomValue=A,window.getFilterValue=x,window.filter=q,window.useFilter=z,window.storage=T,window.useStorage=R,window.useStorageItem=U})();