/**  @license Atomic State
 * Copyright (c) Dany Beltran
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */ (()=>{let{createContext:e,useCallback:t,useContext:n,useEffect:i,useMemo:r,useRef:o,useState:a}=React;class f{constructor(){this.suscribers={}}async addListener(e,t){e in this.suscribers||(this.suscribers[e]={});let n=Object.keys(this.suscribers[e]).length+1;"__proto__"!==e&&"prototype"!==e?this.suscribers[e][n]=t:console.warn('"prototype" and "__proto__" are not valid message names')}async removeListener(e,t){for(let n in this.suscribers[e])this.suscribers[e][n]===t&&delete this.suscribers[e][n]}emit(e,t){for(let n in this.suscribers[e])this.suscribers[e][n](t)}}function s(){let e=new f;return{observer:e,notify:function t(n,i,r){e.emit(n,{storeName:n,hookCall:i,payload:r})}}}let u={},l={},d={},c={},m={},y={},v={},$={},p={},g=e({prefix:"store"}),h=({children:e,atoms:t,filters:i,prefix:o="store"})=>{let a=n(g),f=void 0===o?a.prefix:o;if(t)for(let s in t)void 0===d[`${f}-${s}`]&&(d[`${f}-${s}`]=t[s],c[`${f}-${s}`]=!0);if(i)for(let u in i)void 0===v[`${f}-${u}`]&&(v[`${f}-${u}`]=i[u],m[`${f}-${u}`]=!0);let y=Object.values(l),$=r(()=>y.map(e=>React.createElement(AtomInitialize,{key:e.name+o,atm:e})),[]);return React.createElement(g.Provider,{value:{prefix:f}},$,e)},b={},L={};function I(e){let t={};for(let n in d){let[i,r]=n.split("-");void 0===t[i]&&(t[i]={filters:{},atoms:{}}),t[i].atoms[r]=d[n]}for(let o in v){let[a,f]=o.split("-");void 0===t[a]&&(t[a]={filters:{},atoms:{}}),t[a].filters[f]=v[o]}return void 0===e?t:t[e]||{}}function _(e,t="store"){let n=[t,e].join("-");return d[n]}function w(e,t="store"){let n=[t,e].join("-");return v[n]}function j(e){let{effects:f=[],persist:l,localStoragePersistence:m,sync:y=!0,onSync:h=()=>{}}=e,{prefix:I}=n(g),_=I+"-"+e.name,[w,j]=a(!1),k=m||l,E=r(()=>`${Math.random()}`.split(".")[1],[]);_ in $||($[_]=[]);let N=void 0!==e.default,A=function t(){let n=void 0===d[_]&&"function"==typeof e.default,i=n?e.default():e.default instanceof Promise?e.default:void 0,r=i instanceof Promise,o=N&&void 0===d[_]?r?e.default:void 0!==i?i:e.default:d[_];try{return k?"undefined"!=typeof localStorage&&(void 0===d[_]||c[_])&&(c[_]=!1,d[_]=r?void 0:o):void 0===d[_]&&(d[_]=o),o}catch(a){return o}}(),[S,x]=a(()=>{try{return(async()=>{let t="undefined"==typeof localStorage?e.default:await localStorage.getItem(_);return"undefined"==typeof localStorage?e.default:JSON.parse(t)||e.default})()}catch(t){return A}}),[V,C]=a((A instanceof Promise||"function"==typeof A)&&void 0===d[_]?void 0:(d[_]=A,A));p[_]||(p[_]=0),u[_]||(u[_]=s());let{observer:D,notify:F}=u[_],[K,T]=a(!1),W=o(!1),P=t(t=>{let n=!1,i,r;function o(){n=!0}i="function"==typeof t?t(d[_]):t,r=(()=>{try{return JSON.stringify(i)!==JSON.stringify(d[_])}catch(e){return!1}})();let a=(()=>{try{if("function"==typeof d[_])return!0;if(JSON.stringify(i)===JSON.stringify(e.default)&&!b[_])return b[_]=!0,!0}catch(t){return!0}})(),s="function"==typeof d[_]||r||a;try{for(let u of $[_])u()}catch(l){}finally{$[_]=[];try{for(let c of f){let m=c({previous:V,state:i,dispatch:P,cancel:o});m instanceof Promise?m.then(e=>{void 0===e||e?"function"==typeof e&&$[_].push(e):n=!0}):void 0===m||m?"function"==typeof m&&$[_].push(m):n=!0}}catch(y){T(!0)}finally{if(!n){d[_]=i,k&&localStorage.setItem(_,JSON.stringify(i));try{s&&F(_,E,i)}finally{C(i)}}}}},[E,F,K,_,k,W,V,e.name,]);i(()=>{async function e(){if("undefined"!=typeof localStorage&&void 0!==localStorage[_])try{if(localStorage[_]!==JSON.stringify(d[_])){let e=JSON.parse(localStorage[_]);P(e),await h(e)}}catch(t){}}if(k&&"undefined"!=typeof window){let t=void 0!==window.addEventListener;if(t&&y)return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}return()=>{}},[e.name]),i(()=>{async function e(){if(L[_]=!0,void 0!==S&&!W.current){let e=setTimeout(async()=>{if(k){let e=await S;JSON.stringify(e)===JSON.stringify(d[_])||b[_]||P(e),j(!0)}},0),t=setTimeout(()=>{x(void 0),W.current=!0},0);return()=>{clearTimeout(e),clearTimeout(t)}}}L[_]||e()},[S,P,W]),i(()=>{async function t(){var t;if(void 0===d[_]&&"function"==typeof e.default){if(0===p[_]){p[_]+=1;let n=void 0!==e.default?(async()=>"function"==typeof e.default?e.default():e.default)():void 0;void 0!==n&&n.then(e=>{d[_]=e,F(_,E,d[_]),P(e)})}else p[_]+=1,(V||d[_])&&(null===(t=u[_])||void 0===t||t.notify(_,E,void 0!==V?V:d[_]))}}t()},[V,e.default,P,e.name,E]),i(()=>()=>{p[_]=0},[e.name]),i(()=>{let e=async e=>{e.hookCall!==E&&C(e.payload)};return D.addListener(_,e),()=>{D.removeListener(_,e)}},[K]),i(()=>{async function e(){if("undefined"!=typeof localStorage){let e=await localStorage.getItem(_);(void 0!==e||null===e)&&(k?localStorage.setItem(_,JSON.stringify(V)):localStorage.removeItem(_))}}e()},[e.name,k,V]);let q=t(function(e){let t=[I,e["atom-name"]].join("-"),n=d[t];return n},[I]),z=t(function(e){let t=[I,e["filter-name"]].join("-"),n=v[t];return n},[I]),B=r(()=>e.actions||{},[e.actions]),G=r(()=>Object.fromEntries(Object.keys(B).map(e=>[e,t=>B[e]({args:t,state:V,dispatch:P,get:q,read:z}),])),[V]);return[V,P,G]}let k={};function E(e){e.ignoreKeyWarning&&(k[e.name]=!0),y[e.name]=!0;let t=()=>j(e);return t["atom-name"]=e.name,t["init-object"]=e,t}let N=E,A={},S={},x={},V={};function C(e){let{name:o="",get:f}=e,l={},c={},y=()=>{let $={},p={};y.deps={};let{prefix:h}=n(g);l[`${h}-`]||(l[`${h}-`]={});let b=h+"-"+o;x[b]||(x[b]=s());let L=x[b],I=t(function e(t,n){L.notify(b,t,n)},[h,b]),_=r(()=>({get:e=>("function"!=typeof e?(l[`${h}-`][`${h}-${e.name}`]=!0,$[`${h}-${e.name}`]=d[`${h}-${e.name}`],y.deps=Object.assign(Object.assign({},y.deps),{[`${h}-${e.name}`]:!0})):(l[`${h}-`][`${h}-${e["atom-name"]}`]=!0,$[`${h}-${e["atom-name"]}`]=d[`${h}-${e["atom-name"]}`],y.deps=Object.assign(Object.assign({},y.deps),{[`${h}-${e["atom-name"]}`]:!0})),"function"!=typeof e?void 0===d[`${h}-${e.name}`]?e.default:d[`${h}-${e.name}`]:void 0===d[`${h}-${e["atom-name"]}`]?e["init-object"].default:d[`${h}-${e["atom-name"]}`]),read(e){var t;return"function"!=typeof e?p[`${h}-${e.name}`]=!0:p[`${h}-${e["filter-name"]}`]=!0,"function"!=typeof e?void 0===v[`${h}-${e.name}`]?e.default:v[`${h}-${e.name}`]:void 0===v[`${h}-${e["filter-name"]}`]?null===(t=e["init-object"])||void 0===t?void 0:t.default:v[`${h}-${e["filter-name"]}`]}}),[h]),w=r(()=>Math.random(),[]),j=function t(){try{return S[b]?v[b]:(()=>{S[b]=!0,v[b]=e.default;let t;try{if(t=f(_),void 0===t)return e.default;(async()=>{v[b]=await t})()}catch(n){}finally{return t}})()}catch(n){return e.default}}(),[k,E]=a(()=>j instanceof Promise||void 0===j?e.default:(v[b]=j,j));async function N(e){if("function"==typeof e.payload||JSON.stringify(e.payload)!==JSON.stringify($[e.storeName])){e.storeName in l[`${h}-`]&&($[e.storeName]=e.payload);try{if(!c[b]){c[b]=!0;let t=setTimeout(async()=>{let n=e.storeName in l[`${h}-`]||e.storeName in p?await f(_):v[b];v[b]=n,I(w,n),"function"==typeof n?E(()=>n):E(n),c[b]=!1,clearTimeout(t)},0)}}catch(n){}}}async function A(e){let{storeName:t,payload:n}=e;w!==e.hookCall&&("function"==typeof n?E(()=>n):E(n))}return i(()=>{S[b]||I(w,k)},[k,b]),i(()=>{j instanceof Promise&&j.then(e=>{v[b]=e,E(e)})},[j]),i(()=>()=>{S[b]=!1},[]),i(()=>{var e,t;if(!V[b]){for(let n in V[b]=!0,S[b]||f(_),l[`${h}-`])null===(e=u[n])||void 0===e||e.observer.addListener(n,N);for(let i in p)null===(t=x[i])||void 0===t||t.observer.addListener(i,N);return()=>{var e,t;for(let n in m[b]=!0,l[`${h}-`])null===(e=u[n])||void 0===e||e.observer.removeListener(n,N);for(let i in p)null===(t=x[i])||void 0===t||t.observer.removeListener(i,N)}}},[e,h]),i(()=>{var e;return null===(e=L.observer)||void 0===e||e.addListener(b,A),()=>{var e;V[b]=!1,null===(e=null==L?void 0:L.observer)||void 0===e||e.removeListener(b,A)}},[e,h,k]),k};return y["filter-name"]=o,y["init-object"]=e,y}function D(e){let{prefix:t}=n(g);return"function"!=typeof e?(void 0===A[`${t}-${e.name}`]?A[`${t}-${e.name}`]=C(e):A[`${t}-${e.name}`]["init-object"]!==e&&(A[`${t}-${e.name}`]=C(e)),A[`${t}-${e.name}`]()):e()}let F={};function K(e){return"function"!=typeof e&&(void 0===F[e.name]?F[e.name]=N(e):F[e.name]["init-object"]!==e&&(F[e.name]=N(e))),"function"!=typeof e?F[e.name]():e()}function T(e){return K(e)[0]}function W(e){return K(e)[1]}function P(e){return K(e)[2]}let q=(()=>{let e=new f;return e})();function z(e){let[t,n]=a(e||{});async function r(){let e={};if("undefined"!=typeof localStorage){for(let t in localStorage)if(!t.match(/clear|getItem|key|length|removeItem|setItem/))try{void 0!==localStorage[t]&&(e[t]=JSON.parse(localStorage[t]))}catch(i){e[t]=localStorage[t]}}n(e)}return i(()=>{r()},[]),i(()=>(q.addListener("store-changed",r),()=>{q.removeListener("store-changed",r)}),[]),t}let B={set(e,t){"undefined"!=typeof localStorage&&"function"==typeof localStorage.setItem&&(localStorage.setItem(e,JSON.stringify(t)),q.emit("store-changed",t))},async remove(e){"undefined"!=typeof localStorage&&"function"==typeof localStorage.removeItem&&(localStorage.removeItem(e),q.emit("store-changed",{}))},get(e,t=null){if("undefined"==typeof localStorage)return t;if("function"==typeof localStorage.getItem)try{return JSON.parse(localStorage.getItem(e))}catch(n){return t}else try{return JSON.parse(localStorage[e])}catch(i){return t}}};function G(e,t=null){let[n,r]=a(t),o=()=>{if("undefined"!=typeof localStorage&&JSON.stringify(localStorage[e])!==JSON.stringify(t))try{r(JSON.parse(localStorage[e]))}catch(n){r(t)}};return i(()=>(o(),q.addListener("store-changed",o),()=>{q.removeListener("store-changed",o)}),[]),n}window.atom=E,window.useAtom=K,window.useValue=T,window.useDispatch=W,window.useActions=P,window.AtomicState=h,window.takeSnapshot=I,window.getAtomValue=_,window.getFilterValue=w,window.filter=C,window.useFilter=D,window.storage=B,window.useStorage=z,window.useStorageItem=G})();