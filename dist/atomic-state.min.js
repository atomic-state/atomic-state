/**  @license Atomic State
 * Copyright (c) Dany Beltran
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
*/ (()=>{let{createContext:e,useCallback:t,useContext:n,useEffect:r,useMemo:i,useRef:o,useState:a}=React;class l{constructor(){this.suscribers={}}async addListener(e,t){e in this.suscribers||(this.suscribers[e]={});let n=Object.keys(this.suscribers[e]).length+1;"__proto__"!==e&&"prototype"!==e?this.suscribers[e][n]=t:console.warn('"prototype" and "__proto__" are not valid message names')}async removeListener(e,t){for(let n in this.suscribers[e])this.suscribers[e][n]===t&&delete this.suscribers[e][n]}emit(e,t){for(let n in this.suscribers[e])this.suscribers[e][n](t)}}function u(){let e=new l;return{observer:e,notify:function t(n,r,i){e.emit(n,{storeName:n,hookCall:r,payload:i})}}}let s={},f={},c={},d={},m={},v={},y={},$={},p={},h={},g="undefined"!=typeof localStorage?localStorage:{getItem(){},setItem(){},removeItem(){}},b=e({prefix:"store",persistenceProvider:g});function j({atm:e}){return H(e),null}function I({filt:e}){return B(e),null}function L(e){return void 0!==e}function _(e){return"function"==typeof e}function w(e){return e instanceof Promise}function E(e,t){return JSON.stringify(e)===JSON.stringify(t)}let N=({children:e,atoms:t,filters:r,prefix:o="store",persistenceProvider:a=g})=>{let l=n(b),u=L(o)?o:l.prefix;if(t)for(let s in t){let y=`${u}-${s}`;L(f[y])||(f[y]=t[s],m[y]=!0)}if(r)for(let p in r){let h=`${u}-${p}`;L($[h])||($[h]=r[p],v[h]=!0)}let _=Object.values(c),w=i(()=>Math.random(),[]).toString(),E=i(()=>_.map(e=>React.createElement(React.StrictMode,{key:(null==e?void 0:e.name)+o+w},React.createElement(j,{atm:e}))),[_]),N=Object.values(d),k=i(()=>N.map(e=>React.createElement(React.StrictMode,{key:(null==e?void 0:e.name)+o+w},React.createElement(I,{filt:e}))),[N]);return React.createElement(b.Provider,{value:{prefix:u,persistenceProvider:a}},React.createElement(React.Fragment,null,E,k),e)},k={},A={};function S(e){let t={};for(let n in f){let[r,i]=n.split("-");L(t[r])||(t[r]={filters:{},atoms:{}}),t[r].atoms[i]=f[n]}for(let o in $){let[a,l]=o.split("-");L(t[a])||(t[a]={filters:{},atoms:{}}),t[a].filters[l]=$[o]}return L(e)?t[e]||{}:t}function P(e,t="store"){let n=[t,e].join("-");return f[n]}function V(e,t="store"){let n=[t,e].join("-");return $[n]}function x(e){let{prefix:l,persistenceProvider:c}=n(b),{effects:d=[],persist:v,localStoragePersistence:y,sync:g=!0,onSync:j=()=>{},persistenceProvider:I=c}=e,N=l+"-"+e.name,[S,P]=a(!1),V=y||v,x=i(()=>`${Math.random()}`.split(".")[1],[]);N in p||(p[N]=[]);let F=L(e.default),C=L(f[N])?f[N]:e.default,D=function t(){let n=!L(f[N])&&_(e.default),r=n?e.default():w(e.default)?e.default:void 0,i=w(r),o=F?L(f[N])?C:i?e.default:L(r)?r:C:C;try{return V?"undefined"!=typeof localStorage&&(!L(f[N])||m[N])&&(m[N]=!1,f[N]=i?void 0:o):L(f[N])||(f[N]=o),o}catch(a){return o}}(),[M,K]=a(()=>{if(v&&"undefined"!=typeof window)try{return(async()=>{let t=void 0===I?e.default:await I.getItem(N);return void 0===I?e.default:JSON.parse(t)||C})()}catch(t){return D}}),[W,q]=a((w(D)||_(D))&&!L(f[N])?void 0:(f[N]=D,D));h[N]||(h[N]=0),s[N]||(s[N]=u());let{observer:z,notify:B}=s[N],[G,H]=a(!1),J=o(!1),O=t(e=>{let t=!1,n,r;function i(){t=!0}n=_(e)?e(f[N]):e,r=(()=>{try{return!E(n,f[N])}catch(e){return!1}})();let o=(()=>{try{if(_(f[N]))return!0;if(E(n,C)&&!k[N])return k[N]=!0,!0;return!1}catch(e){return!0}})(),a=_(f[N])||r||o;try{for(let l of p[N])l()}catch(u){}finally{p[N]=[];try{for(let s of d){let c=s({previous:W,state:n,dispatch:O,cancel:i});w(c)?c.then(e=>{L(e)&&!e?t=!0:_(e)&&p[N].push(e)}):L(c)&&!c?t=!0:_(c)&&p[N].push(c)}}catch(m){H(!0)}finally{if(!t){L(n)&&(f[N]=n,V&&I.setItem(N,JSON.stringify(n)));try{a&&L(n)&&B(N,x,n)}finally{L(n)&&q(n)}}}}},[x,B,G,N,V,J,W,e.name,]);r(()=>{async function e(){if("undefined"!=typeof localStorage&&L(localStorage[N]))try{let e=JSON.parse(localStorage[N]);E(e,f[N])||(O(e),await j(e))}catch(t){}}if(V&&"undefined"!=typeof window&&"undefined"!=typeof localStorage&&I===localStorage){let t=L(window.addEventListener);if(t&&g)return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}}return()=>{}},[e.name,V,I]),r(()=>{async function e(){if(A[N]=!0,L(M)&&!J.current){let e=setTimeout(async()=>{if(V){let e=await M;E(e,f[N])||L(k[N])||O(e),P(!0)}},0),t=setTimeout(()=>{K(void 0),J.current=!0},0);return()=>{clearTimeout(e),clearTimeout(t)}}return()=>{}}A[N]||e()},[M,O,J,N]),r(()=>{async function t(){var t;if(!L(f[N])&&_(e.default)){if(0===h[N]){h[N]+=1;let n=L(e.default)?(async()=>_(e.default)?e.default():e.default)():void 0;L(n)&&n.then(e=>{f[N]=e,B(N,x,f[N]),O(e)})}else h[N]+=1,(W||f[N])&&(null===(t=s[N])||void 0===t||t.notify(N,x,L(W)?W:f[N]))}}t()},[W,C,O,e.name,x]),r(()=>()=>{h[N]=0},[e.name]),r(()=>{let e=async e=>{e.hookCall!==x&&L(e.payload)&&q(e.payload)};return z.addListener(N,e),()=>{z.removeListener(N,e)}},[G]),r(()=>{async function t(){if("undefined"!=typeof localStorage){let t=await I.getItem(N);(L(t)||null===t)&&(V?L(W)&&!E(W,e.default)&&I.setItem(N,JSON.stringify(W)):I.removeItem(N))}}t()},[e.name,V,W]);let Q=t(function(e){let t=[l,e["atom-name"]].join("-"),n=f[t];return n},[l]),R=t(function(e){let t=[l,e["filter-name"]].join("-"),n=$[t];return n},[l]),T=i(()=>e.actions||{},[e.actions]),U=i(()=>Object.fromEntries(Object.keys(T).map(e=>[e,t=>T[e]({args:t,state:W,dispatch:O,get:Q,read:R}),])),[W]);return[W,O,U]}let F={};function C(e){e.ignoreKeyWarning&&(F[e.name]=!0),y[e.name]=!0,c[null==e?void 0:e.name]||(c[null==e?void 0:e.name]=e);let t=()=>x(e);return t["atom-name"]=e.name,t["init-object"]=e,t}let D=C,M={},K={},W={},q={};function z(e){L(d[null==e?void 0:e.name])||(d[null==e?void 0:e.name]=e);let{name:o=""}=d[null==e?void 0:e.name],l={},c={},m={},v={},y={},p=()=>{let p=i(()=>Math.random(),[]),{prefix:h}=n(b);l[`${h}-`]||(l[`${h}-`]={});let g=h+"-"+o;W[g]||(W[g]=u());let j=W[g],I=t(function e(t,n){j.notify(g,t,n)},[h,p,g]);for(let N in l[`${h}-`])y[N]!==f[N]&&(K[g]=!1);for(let k in m)v[k]!==$[k]&&(K[g]=!1);let A=i(()=>({get(e){var t;if(q[g]=!0,_(e)){let n=[h,null===(t=null==e?void 0:e["init-object"])||void 0===t?void 0:t.name,].join("-");l[`${h}-`][n]=!0,y[n]=f[n]}else{let r=[h,e.name].join("-");l[`${h}-`][r]=!0,y[r]=f[r]}let i=[h,C.name].join("-"),o=[h,e["atom-name"]].join("-");return _(e)?L(f[o])?f[o]:e["init-object"].default:L(f[i])?f[i]:e.default},read(e){var t;q[g]=!0;let n=_(e)?[h,e["filter-name"]].join("-"):[h,e.name].join("-");return _(e),m[n]=!0,v[n]=$[n],_(e)?L($[n])?$[n]:null===(t=e["init-object"])||void 0===t?void 0:t.default:L($[n])?$[n]:e.default}}),[h]),S=$[g],P=function t(){try{let n;return K[g]?$[g]:(()=>{var t;K[g]=!0,$[g]=e.default;try{if(n=null===(t=d[o])||void 0===t?void 0:t.get(A),!L(n))return e.default;return(async()=>{n=await n,$[g]=n,L(n)&&I("",n)})(),n}catch(r){}finally{return L(n)&&I("",n),n}})()}catch(r){return e.default}}();K[g]=!0,w(P)&&($[g]=P,setTimeout(async()=>{$[g]=await P,I(p,await $[g])},0)),L(P)?w(P)?P.then(e=>{S=e,$[g]=e,j.notify(g,"",e)}):(S=P,$[g]=P):L(S)||(S=e.default);let[V,x]=a(()=>L(S)&&w(S)?w(P)?e.default:P:S);async function F(e){var t;let n=e.storeName in m;if(_(e.payload)||(n?!E($[e.storeName],v[e.storeName]):!E(e.payload,y[e.storeName]))){e.storeName in(n?m:l[`${h}-`])&&L(e.payload)&&(n?v[e.storeName]=e.payload:y[e.storeName]=e.payload);try{if(!c[g]){c[g]=!0;let r=e.storeName in l[`${h}-`]||e.storeName in m?null===(t=d[o])||void 0===t?void 0:t.get(A):$[g];$[g]=r,(async()=>{if(_(r))I(p,r),x(()=>r);else if(L(r)){if(w(r)){let e=await r;x(e),I(p,e)}else x(r),I(p,r)}c[g]=!1})()}}catch(i){}}}async function D(e){let{payload:t}=e;if(p!==e.hookCall){let n=await t;_(n)?x(()=>n):L(n)&&x(n)}}return r(()=>{var e;null===(e=s[g])||void 0===e||e.notify(g,"",V)},[V]),r(()=>{!K[g]&&L(V)&&I(p,V)},[V,p,g,K[g]]),r(()=>{w(P)&&P.then(e=>{L(e)&&($[g]=e,x(e))})},[P]),r(()=>{var e,t;for(let n in l[`${h}-`])null===(e=s[n])||void 0===e||e.observer.addListener(n,F);for(let r in m)null===(t=W[r])||void 0===t||t.observer.addListener(r,F);return()=>{var e,t;for(let n in l[`${h}-`])null===(e=s[n])||void 0===e||e.observer.removeListener(n,F);for(let r in m)null===(t=W[r])||void 0===t||t.observer.removeListener(r,F)}},[]),r(()=>{var e;return null===(e=j.observer)||void 0===e||e.addListener(g,D),()=>{var e;null===(e=null==j?void 0:j.observer)||void 0===e||e.removeListener(g,D)}},[g]),V};return p["filter-name"]=o,p["init-object"]=e,p}function B(e){let{prefix:t}=n(b);if(_(e)){let r=e["init-object"];r!==d[null==r?void 0:r.name]&&L(r)&&((d[null==r?void 0:r.name]||{}).get=null==r?void 0:r.get)}else d[e.name]!==e&&((d[null==e?void 0:e.name]||{}).get=null==e?void 0:e.get);return _(e)?e():(()=>{let n=[t,e.name].join("-");return L(M[n])?M[n]["init-object"]!==e&&(M[n]=z(e)):M[n]=z(d[e.name]),M[n]()})()}let G={};function H(e){return _(e)||(L(G[e.name])?G[e.name]["init-object"]!==e&&(G[e.name]=D(e)):G[e.name]=D(e)),_(e)?e():G[e.name]()}function J(e){return H(e)[0]}let O=J;function Q(e){return H(e)[1]}let R=Q;function T(e){return H(e)[2]}let U=T;function X(e){function t(t){let n=e[t],r=H(n),i=r;return i.value=r[0],i.dispatch=r[1],i.actions=r[2],i}return t.value=function t(n){let r=e[n];return J(r)},t.dispatch=function t(n){let r=e[n];return Q(r)},t.actions=function t(n){let r=e[n];return T(r)},t}function Y(e){return function t(n){let r=e[n];return B(r)}}let Z=(()=>{let e=new l;return e})();function ee(e){let[t,n]=a(e||{});async function i(){let e={};if("undefined"!=typeof localStorage){for(let t in localStorage)if(!t.match(/clear|getItem|key|length|removeItem|setItem/))try{L(localStorage[t])&&(e[t]=JSON.parse(localStorage[t]))}catch(r){e[t]=localStorage[t]}}n(e)}return r(()=>{i()},[]),r(()=>(Z.addListener("store-changed",i),()=>{Z.removeListener("store-changed",i)}),[]),t}let et={set(e,t){"undefined"!=typeof localStorage&&_(localStorage.setItem)&&(localStorage.setItem(e,JSON.stringify(t)),Z.emit("store-changed",t))},async remove(e){"undefined"!=typeof localStorage&&_(localStorage.removeItem)&&(localStorage.removeItem(e),Z.emit("store-changed",{}))},get(e,t=null){if("undefined"==typeof localStorage)return t;if(_(localStorage.getItem))try{return JSON.parse(localStorage.getItem(e))}catch(n){return t}else try{return JSON.parse(localStorage[e])}catch(r){return t}}};function en(e,t=null){let[n,i]=a(t),o=()=>{if("undefined"!=typeof localStorage&&!E(localStorage[e],t))try{i(JSON.parse(localStorage[e]))}catch(n){i(t)}};return r(()=>(o(),Z.addListener("store-changed",o),()=>{Z.removeListener("store-changed",o)}),[]),n}window.useAtomValue=O,window.useAtomDispatch=R,window.useAtomActions=U,window.atomProvider=X,window.filterProvider=Y,window.atom=C,window.useAtom=H,window.useValue=J,window.useDispatch=Q,window.useActions=T,window.AtomicState=N,window.takeSnapshot=S,window.getAtomValue=P,window.getFilterValue=V,window.filter=z,window.useFilter=B,window.storage=et,window.useStorage=ee,window.useStorageItem=en})();